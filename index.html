<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –ú–µ–Ω—é –ö–æ—Ñ–µ–π–Ω–∏ v2</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <style>
        /* –°–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π –∏ –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --primary-color: #6F4E37; /* –ö–æ—Ñ–µ–π–Ω—ã–π */
            --secondary-color: #F5F5DC; /* –ë–µ–∂–µ–≤—ã–π */
            --accent-color: #E0A96D; /* –°–≤–µ—Ç–ª–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π / –ó–æ–ª–æ—Ç–∏—Å—Ç—ã–π */
            --text-color: #333;
            --white-color: #FFFFFF;
            --success-color: #4CAF50;
            --error-color: #dc3545; /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –æ—à–∏–±–æ–∫ */
            --disabled-color: #cccccc;
            --transition-speed: 0.4s;
            --transition-speed-fast: 0.2s;
            --border-radius: 15px;
            --border-radius-small: 8px;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* –û–±—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 15px;
            width: 100%;
            flex-grow: 1;
            display: flex; /* Changed to flex */
            flex-direction: column; /* Ensure column layout */
            position: relative; /* For view transitions */
            overflow: hidden; /* Clip views during transition */
        }

        /* –®–∞–ø–∫–∞ */
        header {
            background-color: var(--primary-color);
            color: var(--white-color);
            padding: 15px 60px 15px 15px;
            text-align: center;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.5s ease-out;
            position: relative;
        }

        header h1 {
            font-size: 1.8em;
            font-weight: 600;
            margin: 0;
            line-height: 1.2;
        }

        /* –ö–Ω–æ–ø–∫–∞ –ö–æ—Ä–∑–∏–Ω—ã */
        .btn-cart {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            right: 15px;
            padding: 8px 12px;
            background-color: var(--accent-color);
            color: var(--white-color);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1.2em;
            line-height: 1;
            transition: background-color var(--transition-speed-fast) ease, transform var(--transition-speed-fast) ease;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 101;
        }
        .btn-cart:hover {
            background-color: #c89053;
            transform: translateY(-50%) scale(1.05);
        }
        #cart-count {
            background-color: var(--primary-color);
            color: var(--white-color);
            font-size: 0.7em;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
            min-width: 18px;
            text-align: center;
            line-height: 1;
        }

        /* –°–µ–∫—Ü–∏–∏ (–í–∏–¥—ã) */
        .view {
             /* display: none; */ /* Managed by active/transition classes now */
            flex-direction: column;
            width: 100%;
            background-color: var(--white-color);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            flex-grow: 1;
            /* Animation / Transition properties */
            opacity: 0;
            transform: translateX(100%);
            transition: opacity var(--transition-speed) ease-out, transform var(--transition-speed) ease-out;
            position: absolute; /* Needed for transition */
            top: 0;
            left: 0;
            visibility: hidden; /* Hide inactive views completely */
             display: flex; /* Keep flex for layout even when hidden */
         }

         .view.active {
            opacity: 1;
            transform: translateX(0);
            position: relative; /* Bring active view back into flow */
            z-index: 10; /* Ensure active view is on top */
            visibility: visible;
         }

         .view.exiting { /* Class for view that is leaving */
             transform: translateX(-100%);
             z-index: 5;
             opacity: 0;
         }


        h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5em;
        }

        /* –ú–µ–Ω—é: –ö–æ–Ω—Ç—Ä–æ–ª—ã */
         #menu-controls {
             border-bottom: 1px solid var(--accent-color);
             padding-bottom: 15px;
             margin-bottom: 20px;
             display: flex;
             flex-wrap: wrap;
             gap: 15px; /* Increased gap */
             align-items: center;
         }
         #category-filters {
            display: flex;
            gap: 8px;
            flex-grow: 1;
            flex-wrap: wrap; /* Allow filters to wrap on small screens */
         }
         .btn-filter {
             padding: 6px 15px;
             border: 1px solid var(--primary-color);
             background-color: transparent;
             color: var(--primary-color);
             border-radius: 20px;
             cursor: pointer;
             transition: all var(--transition-speed-fast) ease;
             font-size: 0.9em;
             flex-shrink: 0;
         }
         .btn-filter.active, .btn-filter:hover {
             background-color: var(--primary-color);
             color: var(--white-color);
             transform: scale(1.03);
         }
         #menu-search {
             padding: 8px 12px;
             border: 1px solid #ddd;
             border-radius: 20px;
             font-size: 0.9em;
             min-width: 150px;
             transition: border-color var(--transition-speed-fast) ease;
         }
         #menu-search:focus {
             outline: none;
             border-color: var(--primary-color);
         }

        /* –ú–µ–Ω—é: –°–µ—Ç–∫–∞ */
        #menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }
        .menu-item {
            background-color: #fff;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: transform var(--transition-speed-fast) ease, box-shadow var(--transition-speed-fast) ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px;
            border: 1px solid #eee;
            position: relative; /* For disabled overlay */
        }
        .menu-item:hover:not(.disabled) {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 8px 15px rgba(111, 78, 55, 0.2);
        }
        .menu-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            display: block;
            margin-bottom: 10px;
            border-radius: calc(var(--border-radius) - 5px);
        }
        .menu-item h3 {
            font-size: 1em;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        .menu-item .price {
            font-size: 0.9em;
            font-weight: bold;
            color: var(--text-color);
        }
        /* Disabled state for menu items */
        .menu-item.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        .menu-item.disabled::after {
            content: '–ù–µ—Ç';
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            background-color: rgba(255, 0, 0, 0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: bold;
        }


        /* –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è */
        .customization-option {
            margin-bottom: 20px;
            transition: opacity 0.3s ease, max-height 0.4s ease; /* Animation */
            overflow: hidden; /* Needed for max-height transition */
        }
        /* Hide options smoothly */
        .customization-option:not(.visible) {
             opacity: 0;
             max-height: 0;
             margin-bottom: 0;
             overflow: hidden;
             padding: 0;
             border: none;
        }
         .customization-option.visible {
             opacity: 1;
             max-height: 500px; /* Adjust if needed */
         }

        .customization-option h4 { /* Styles from before */ }
        .option-group { /* Styles from before */ }
        .option-group label { /* Styles from before */ }
        .option-group input[type="radio"] { /* Styles from before */ }
        .option-group input[type="radio"]:checked + label { /* Styles from before */ }
         /* Disabled state for options */
         .option-group input[type="radio"]:disabled + label {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: var(--disabled-color);
            border-color: #bbb;
            color: #777;
         }
         .option-group input[type="radio"]:disabled:checked + label {
            background-color: #a0a0a0; /* Darker grey when checked but disabled */
         }


        #current-item-price { /* Styles from before */ }

        /* –ö–æ—Ä–∑–∏–Ω–∞ / –ó–∞–∫–∞–∑ */
        #order-items-list {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }
        #order-items-list li {
            background-color: var(--secondary-color);
            padding: 10px 12px; /* Adjusted padding */
            margin-bottom: 10px;
            border-radius: var(--border-radius-small);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: nowrap; /* Prevent wrapping for controls */
            border-left: 5px solid var(--accent-color);
            transition: background-color 0.3s ease, opacity 0.4s ease, transform 0.4s ease;
            overflow: hidden; /* Clip content during animation */
        }
        /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è */
        #order-items-list li.item-entering {
            opacity: 0;
            transform: translateX(-20px);
        }
        #order-items-list li.item-leaving {
            opacity: 0;
            transform: scale(0.9);
            background-color: #ffdddd;
        }

        #order-items-list li .item-details {
            flex-grow: 1;
            margin-right: 10px;
            overflow: hidden; /* Prevent long names breaking layout */
            white-space: nowrap; /* Keep name on one line */
            text-overflow: ellipsis; /* Add ... for long names */
        }
        #order-items-list li .item-name {
            font-weight: bold;
            color: var(--primary-color);
            display: block;
             white-space: nowrap;
             text-overflow: ellipsis;
             overflow: hidden;
        }
        #order-items-list li .item-customizations {
            font-size: 0.8em; /* Slightly smaller */
            color: #555;
            display: block;
            margin-top: 2px;
             white-space: nowrap;
             text-overflow: ellipsis;
             overflow: hidden;
        }
         /* Controls container */
         #order-items-list li .item-controls {
             display: flex;
             align-items: center;
             gap: 8px; /* Gap between control groups */
             margin-left: auto; /* Push to right */
             flex-shrink: 0; /* Prevent shrinking */
         }
         .quantity-controls {
             display: flex;
             align-items: center;
             gap: 5px;
             white-space: nowrap;
         }
         .quantity-controls .btn-quantity {
             background-color: var(--accent-color);
             color: white;
             border: none;
             border-radius: 50%;
             width: 22px;
             height: 22px;
             font-size: 14px;
             line-height: 20px; /* Adjusted for centering */
             text-align: center;
             cursor: pointer;
             transition: background-color var(--transition-speed-fast) ease, transform var(--transition-speed-fast) ease;
             padding: 0;
             display: flex; /* Center content */
             justify-content: center; /* Center content */
             align-items: center; /* Center content */
         }
         .quantity-controls .btn-quantity:hover {
             background-color: #c89053;
             transform: scale(1.1);
         }
         .quantity-controls .item-quantity {
             font-weight: bold;
             min-width: 20px;
             text-align: center;
             font-size: 0.95em;
         }
         .item-price { /* Price shown in cart controls */
             font-weight: bold;
             white-space: nowrap;
             font-size: 0.95em;
             min-width: 50px; /* Ensure some space */
             text-align: right;
         }
         .btn-edit-item {
             background: none;
             border: none;
             font-size: 1.1em; /* Slightly smaller */
             cursor: pointer;
             color: var(--primary-color);
             padding: 0 3px; /* Reduced padding */
             transition: transform var(--transition-speed-fast) ease;
             line-height: 1;
         }
         .btn-edit-item:hover {
             transform: scale(1.15);
         }
         .btn-remove-item { /* Styles mostly from before */
             background: #ff4d4d;
             color: white;
             border: none;
             border-radius: 50%;
             width: 22px; /* Matched quantity buttons */
             height: 22px;
             font-size: 14px;
             cursor: pointer;
             line-height: 22px; /* Adjusted */
             text-align: center;
             padding: 0;
             flex-shrink: 0;
             transition: background-color var(--transition-speed-fast) ease, transform var(--transition-speed-fast) ease;
         }
         .btn-remove-item:hover {
             background-color: #e60000;
             transform: scale(1.1);
         }


        #order-total { /* Styles from before */ }
        #qr-code-container { /* Styles from before */ }
        #qr-code { /* Styles from before */ }
        #qr-code img { /* Styles from before */ }
        #order-status-container { /* Styles from before */ }
        #order-status-container h4 { /* Styles from before */ }
        #order-status { /* Styles from before */ }
        .status-pending, .status-processing, .status-ready { /* Styles from before */ }

        /* –ö–Ω–æ–ø–∫–∏ */
        .button-group { /* Styles from before */ }
        .btn { /* Styles from before */ }
        /* Individual button styles (.btn-primary etc) - Styles from before */

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn { /* Styles from before */ }
        @keyframes slideDown { /* Styles from before */ }
        @keyframes spin { /* Styles from before */ }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loader { /* Styles from before */ }

        /* –ü—É—Å—Ç–æ–π –∑–∞–∫–∞–∑ */
        #empty-order-message { /* Styles from before */ }

        /* –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .temp-message { /* Styles from before */ }
        .temp-message.success { /* Styles from before */ }
        .temp-message.error { /* Styles from before */ }
        .temp-message.info { /* Styles from before */ }
        .temp-message.show { /* Styles from before */ }

        /* Footer */
        footer { /* Styles from before */ }

    </style>
</head>
<body>

    <header>
        <h1>–£—é—Ç–Ω–æ–µ –ö–æ—Ñ–µ v2</h1>
        <button id="go-to-cart-btn" class="btn-cart">üõí <span id="cart-count">0</span></button>
    </header>

    <div class="container">

        <section id="menu-view" class="view active">
            <h2>–ú–µ–Ω—é</h2>
            <div id="menu-controls">
                <div id="category-filters">
                    <button class="btn btn-filter active" data-category="all">–í—Å–µ</button>
                    <button class="btn btn-filter" data-category="coffee">–ö–æ—Ñ–µ</button>
                    <button class="btn btn-filter" data-category="dessert">–î–µ—Å–µ—Ä—Ç—ã</button>
                </div>
                <input type="search" id="menu-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...">
            </div>
            <div id="menu-grid">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é...</p>
            </div>
        </section>

        <section id="customization-view" class="view">
            <h2 id="customization-item-name">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–∞—à –Ω–∞–ø–∏—Ç–æ–∫</h2>

            <div class="customization-option visible" id="volume-option-section">
                 <h4>–û–±—ä—ë–º</h4>
                 <div class="option-group" id="volume-options">
                     <input type="radio" id="volume-small" name="volume" value="–ú–∞–ª–µ–Ω—å–∫–∏–π" data-multiplier="1.0" checked>
                     <label for="volume-small">–ú–∞–ª–µ–Ω—å–∫–∏–π (S)</label>
                     <input type="radio" id="volume-medium" name="volume" value="–°—Ä–µ–¥–Ω–∏–π" data-multiplier="1.2">
                     <label for="volume-medium">–°—Ä–µ–¥–Ω–∏–π (M)</label>
                     <input type="radio" id="volume-large" name="volume" value="–ë–æ–ª—å—à–æ–π" data-multiplier="1.5">
                     <label for="volume-large">–ë–æ–ª—å—à–æ–π (L)</label>
                 </div>
             </div>

            <div class="customization-option visible" id="sweetness-option-section">
                <h4>–°–ª–∞–¥–æ—Å—Ç—å</h4>
                <div class="option-group" id="sweetness-options">
                    <input type="radio" id="sweet-none" name="sweetness" value="–ë–µ–∑ —Å–∞—Ö–∞—Ä–∞" data-price-mod="0" checked>
                    <label for="sweet-none">–ë–µ–∑ —Å–∞—Ö–∞—Ä–∞</label>
                    <input type="radio" id="sweet-low" name="sweetness" value="–ù–µ–º–Ω–æ–≥–æ" data-price-mod="10">
                    <label for="sweet-low">–ù–µ–º–Ω–æ–≥–æ (+10‚Ç∏)</label>
                    <input type="radio" id="sweet-standard" name="sweetness" value="–°—Ç–∞–Ω–¥–∞—Ä—Ç" data-price-mod="20">
                    <label for="sweet-standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç (+20‚Ç∏)</label>
                    <input type="radio" id="sweet-high" name="sweetness" value="–°–ª–∞–¥–∫–∏–π" data-price-mod="30">
                    <label for="sweet-high">–°–ª–∞–¥–∫–∏–π (+30‚Ç∏)</label>
                </div>
            </div>

            <div class="customization-option visible" id="strength-option-section">
                <h4>–ö—Ä–µ–ø–æ—Å—Ç—å</h4>
                <div class="option-group" id="strength-options">
                    <input type="radio" id="strength-standard" name="strength" value="–°—Ç–∞–Ω–¥–∞—Ä—Ç" checked>
                    <label for="strength-standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç</label>
                    <input type="radio" id="strength-high" name="strength" value="–ö—Ä–µ–ø—á–µ">
                    <label for="strength-high">–ö—Ä–µ–ø—á–µ</label>
                </div>
            </div>

            <div class="customization-option" id="milk-option-section"> <h4>–¢–∏–ø –º–æ–ª–æ–∫–∞</h4>
                <div class="option-group" id="milk-options">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ü–∏–π –º–æ–ª–æ–∫–∞...</p>
                </div>
            </div>

            <div class="customization-option" id="syrup-option-section"> <h4>–°–∏—Ä–æ–ø</h4>
                <div class="option-group" id="syrup-options">
                     <p>–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ü–∏–π —Å–∏—Ä–æ–ø–∞...</p>
                </div>
            </div>

            <div id="current-item-price">–¶–µ–Ω–∞: 0‚Ç∏</div>
            <div class="button-group">
                 <button id="back-to-menu-btn" class="btn btn-back">–ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é</button>
                 <button id="add-update-order-btn" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑</button>
            </div>
        </section>

        <section id="order-view" class="view">
            <h2>–í–∞—à –∑–∞–∫–∞–∑</h2>
            <div id="order-content">
                 <ul id="order-items-list">
                     </ul>
                 <div id="order-total">–û–±—â–∞—è —Å—É–º–º–∞: 0‚Ç∏</div>
            </div>
            <p id="empty-order-message" style="display: none;">–í–∞—à –∑–∞–∫–∞–∑ –ø–æ–∫–∞ –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–∑ –º–µ–Ω—é!</p>
            <div id="qr-and-status" style="display: none;">
                <div id="qr-code-container">
                    <h4>–í–∞—à QR-–∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞</h4>
                    <div id="qr-code"></div>
                </div>
                <div id="order-status-container">
                    <h4>–°—Ç–∞—Ç—É—Å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</h4>
                    <div id="order-status">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
                    <div id="status-loader" class="loader" style="display: none;"></div>
                </div>
            </div>
            <div class="button-group">
                <button id="clear-order-btn" class="btn btn-back">–û—á–∏—Å—Ç–∏—Ç—å –∑–∞–∫–∞–∑</button>
                <button id="checkout-btn" class="btn btn-confirm">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
                <button id="new-order-btn" class="btn btn-secondary" style="display: none;">–°–¥–µ–ª–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
            </div>
        </section>

    </div>

    <footer>
        ¬© 2025 –£—é—Ç–Ω–æ–µ –ö–æ—Ñ–µ v2. –ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∞–ø–ø–µ—Ç–∏—Ç–∞!
    </footer>

    <script>
        // --- –î–∞–Ω–Ω—ã–µ –ú–µ–Ω—é –∏ –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ ---
        const menuData = [
            // –ö–æ—Ñ–µ (–∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã–π)
            { id: 'espresso', name: '–≠—Å–ø—Ä–µ—Å—Å–æ', basePrice: 500, image: 'https://images.unsplash.com/photo-1511920170033-f8396924c348?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=300&q=80', category: 'coffee', customizable: true, options: ['strength'] },
            { id: 'cappuccino', name: '–ö–∞–ø—É—á–∏–Ω–æ', basePrice: 700, image: 'https://images.unsplash.com/photo-1557006094-40e596d98303?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=300&q=80', category: 'coffee', customizable: true, options: ['volume', 'sweetness', 'strength', 'milk', 'syrup'] },
            { id: 'latte', name: '–õ–∞—Ç—Ç–µ', basePrice: 750, image: 'https://images.unsplash.com/photo-1561882468-91101f2L_ZyQ?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=300&q=80', category: 'coffee', customizable: true, options: ['volume', 'sweetness', 'strength', 'milk', 'syrup'] },
            { id: 'americano', name: '–ê–º–µ—Ä–∏–∫–∞–Ω–æ', basePrice: 600, image: 'https://images.unsplash.com/photo-1580933075516-ac7f7767164a?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=300&q=80', category: 'coffee', customizable: true, options: ['volume', 'strength'] },
            { id: 'mocha', name: '–ú–æ–∫–∫–æ', basePrice: 850, image: 'https://images.unsplash.com/photo-1608079778818-a04d8e4b2e4f?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=300&q=80', category: 'coffee', customizable: true, options: ['volume', 'sweetness', 'strength', 'milk'] },
            { id: 'raf', name: '–†–∞—Ñ', basePrice: 900, image: 'https://images.unsplash.com/photo-1572498859711-ff8e018124c8?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=300&q=80', category: 'coffee', customizable: true, options: ['volume', 'strength', 'syrup'] },
            // –î–µ—Å–µ—Ä—Ç—ã (–Ω–µ –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã–µ)
            { id: 'croissant', name: '–ö—Ä—É–∞—Å—Å–∞–Ω', basePrice: 450, image: 'https://images.unsplash.com/photo-1587132137056-7a8f0165f7d5?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=300&q=80', category: 'dessert', customizable: false, options: [] },
            { id: 'cheesecake', name: '–ß–∏–∑–∫–µ–π–∫', basePrice: 800, image: 'https://images.unsplash.com/photo-1543572858-ab24314cd5cc?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=300&q=80', category: 'dessert', customizable: false, options: [] },
            { id: 'muffin', name: '–ú–∞—Ñ—Ñ–∏–Ω', basePrice: 550, image: 'https://images.unsplash.com/photo-1615310749319-39a1a5911043?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=300&q=80', category: 'dessert', customizable: false, options: [] },
        ];
        const customizationData = {
            volume: [ // –î–æ–±–∞–≤–∏–º —Å—é–¥–∞ –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è
                { id: 'volume-small', name: '–ú–∞–ª–µ–Ω—å–∫–∏–π', multiplier: 1.0, default: true },
                { id: 'volume-medium', name: '–°—Ä–µ–¥–Ω–∏–π', multiplier: 1.2 },
                { id: 'volume-large', name: '–ë–æ–ª—å—à–æ–π', multiplier: 1.5 },
            ],
             sweetness: [
                 { id: 'sweet-none', name: '–ë–µ–∑ —Å–∞—Ö–∞—Ä–∞', priceMod: 0, default: true },
                 { id: 'sweet-low', name: '–ù–µ–º–Ω–æ–≥–æ', priceMod: 10 },
                 { id: 'sweet-standard', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç', priceMod: 20 },
                 { id: 'sweet-high', name: '–°–ª–∞–¥–∫–∏–π', priceMod: 30 },
             ],
             strength: [
                 { id: 'strength-standard', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç', default: true },
                 { id: 'strength-high', name: '–ö—Ä–µ–ø—á–µ' },
             ],
             milk: [
                 { id: 'milk-standard', name: '–û–±—ã—á–Ω–æ–µ', priceMod: 0, default: true },
                 { id: 'milk-skim', name: '–û–±–µ–∑–∂–∏—Ä–µ–Ω–Ω–æ–µ', priceMod: 0 },
                 { id: 'milk-almond', name: '–ú–∏–Ω–¥–∞–ª—å–Ω–æ–µ', priceMod: 150 },
                 { id: 'milk-soy', name: '–°–æ–µ–≤–æ–µ', priceMod: 100 },
             ],
             syrup: [
                 { id: 'syrup-none', name: '–ë–µ–∑ —Å–∏—Ä–æ–ø–∞', priceMod: 0, default: true },
                 { id: 'syrup-vanilla', name: '–í–∞–Ω–∏–ª—å–Ω—ã–π', priceMod: 100 },
                 { id: 'syrup-caramel', name: '–ö–∞—Ä–∞–º–µ–ª—å–Ω—ã–π', priceMod: 100 },
                 { id: 'syrup-hazelnut', name: '–û—Ä–µ—Ö–æ–≤—ã–π', priceMod: 120 },
             ]
         };

        // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
        let currentViewId = 'menu-view';
        let previousViewId = null;
        let selectedItem = null; // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–µ–Ω—é (–∫–æ–ø–∏—è –∏–∑ menuData)
        let currentOrder = []; // –ú–∞—Å—Å–∏–≤ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –∑–∞–∫–∞–∑–∞
        let editingOrderItemId = null; // ID —ç–ª–µ–º–µ–Ω—Ç–∞ –∑–∞–∫–∞–∑–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        // –§–∏–ª—å—Ç—Ä—ã
        let currentFilterCategory = 'all';
        let currentSearchTerm = '';
        const LOCAL_STORAGE_KEY = 'coffeeShopOrder_v2';

        // --- DOM –≠–ª–µ–º–µ–Ω—Ç—ã ---
        const views = { // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–∏–¥—ã –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
             'menu-view': document.getElementById('menu-view'),
             'customization-view': document.getElementById('customization-view'),
             'order-view': document.getElementById('order-view')
        };
        const menuGrid = document.getElementById('menu-grid');
        const categoryFiltersContainer = document.getElementById('category-filters');
        const menuSearchInput = document.getElementById('menu-search');
        // –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è
        const customizationItemName = document.getElementById('customization-item-name');
        const currentItemPriceDisplay = document.getElementById('current-item-price');
        const customizationOptionsContainers = { // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –≥—Ä—É–ø–ø –æ–ø—Ü–∏–π
            volume: document.getElementById('volume-options'),
            sweetness: document.getElementById('sweetness-options'),
            strength: document.getElementById('strength-options'),
            milk: document.getElementById('milk-options'),
            syrup: document.getElementById('syrup-options'),
        };
        const customizationOptionSections = { // –°–µ–∫—Ü–∏–∏ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è/–ø–æ–∫–∞–∑–∞
            volume: document.getElementById('volume-option-section'),
            sweetness: document.getElementById('sweetness-option-section'),
            strength: document.getElementById('strength-option-section'),
            milk: document.getElementById('milk-option-section'),
            syrup: document.getElementById('syrup-option-section'),
        };
        // –ó–∞–∫–∞–∑
        const orderItemsList = document.getElementById('order-items-list');
        const orderTotalDisplay = document.getElementById('order-total');
        const qrCodeContainer = document.getElementById('qr-code');
        const orderStatusDisplay = document.getElementById('order-status');
        const statusLoader = document.getElementById('status-loader');
        const qrAndStatusSection = document.getElementById('qr-and-status');
        const orderContent = document.getElementById('order-content');
        const emptyOrderMessage = document.getElementById('empty-order-message');
        const cartCountSpan = document.getElementById('cart-count');

        // –ö–Ω–æ–ø–∫–∏
        const goToCartBtn = document.getElementById('go-to-cart-btn');
        const backToMenuBtn = document.getElementById('back-to-menu-btn');
        const addUpdateOrderBtn = document.getElementById('add-update-order-btn'); // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞
        const clearOrderBtn = document.getElementById('clear-order-btn');
        const checkoutBtn = document.getElementById('checkout-btn');
        const newOrderBtn = document.getElementById('new-order-btn');

        // --- Helper –§—É–Ω–∫—Ü–∏–∏ ---

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
        function saveOrderToLocalStorage() {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(currentOrder));
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –≤ localStorage:", e);
                showTemporaryMessage("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–∫–∞–∑", "error");
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
        function loadOrderFromLocalStorage() {
            try {
                const savedOrder = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (savedOrder) {
                    currentOrder = JSON.parse(savedOrder);
                    // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ quantity - —á–∏—Å–ª–æ
                    currentOrder.forEach(item => item.quantity = parseInt(item.quantity) || 1);
                } else {
                    currentOrder = [];
                }
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–∞ –∏–∑ localStorage:", e);
                currentOrder = [];
                localStorage.removeItem(LOCAL_STORAGE_KEY); // –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–∏–∑ –ø—Ä–æ—à–ª–æ–π –≤–µ—Ä—Å–∏–∏)
         function showTemporaryMessage(message, type = "info") {
            const msgDiv = document.createElement('div');
            msgDiv.textContent = message;
            msgDiv.className = `temp-message ${type}`;
            document.body.appendChild(msgDiv);
            setTimeout(() => { msgDiv.classList.add('show'); }, 10);
            setTimeout(() => {
                msgDiv.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(msgDiv)) { document.body.removeChild(msgDiv); }
                }, 500);
            }, 2500);
         }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –¥–ª—è –æ–ø—Ü–∏–π –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏
        function generateOptionsHTML(optionType, availableOptionsData, selectedValueId = null) {
            const container = customizationOptionsContainers[optionType];
            if (!container) return ''; // –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω

            container.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞
            let html = '';
            let defaultChecked = false;

            availableOptionsData.forEach(option => {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –¥–æ–ª–∂–Ω–∞ –ª–∏ —ç—Ç–∞ –æ–ø—Ü–∏—è –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω–∞
                 // 1. –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∏ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–æ —É —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                 // 2. –ï—Å–ª–∏ –ù–ï —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∏ —ç—Ç–æ –æ–ø—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–∏ –µ—â–µ –Ω–∏ –æ–¥–Ω–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
                 // 3. –ï—Å–ª–∏ –ù–ï —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º, –Ω–µ—Ç –æ–ø—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è –æ–ø—Ü–∏—è –≤ —Å–ø–∏—Å–∫–µ
                 const isChecked = selectedValueId ? option.id === selectedValueId : (option.default && !defaultChecked);


                 html += `
                    <input type="radio"
                           id="${option.id}"
                           name="${optionType}"
                           value="${option.id}"
                           ${option.priceMod !== undefined ? `data-price-mod="${option.priceMod}"` : ''}
                           ${option.multiplier !== undefined ? `data-multiplier="${option.multiplier}"` : ''}
                           ${isChecked ? 'checked' : ''}
                           >
                     <label for="${option.id}">${option.name}${option.priceMod > 0 ? ` (+${option.priceMod}‚Ç∏)` : ''}</label>
                 `;
                 if (isChecked) defaultChecked = true; // –û—Ç–º–µ—á–∞–µ–º, —á—Ç–æ –Ω–∞—à–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
             });

             // –ï—Å–ª–∏ –Ω–∏ –æ–¥–Ω–∞ –æ–ø—Ü–∏—è –Ω–µ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑-–∑–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è),
             // –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—É—é –æ–ø—Ü–∏—é –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ.
             if (!defaultChecked && availableOptionsData.length > 0) {
                 html = html.replace(`id="${availableOptionsData[0].id}"`, `id="${availableOptionsData[0].id}" checked`);
             }

             container.innerHTML = html; // –í—Å—Ç–∞–≤–ª—è–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTML
         }

         // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏
         function getCustomizationKey(customizations) {
             // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª—é—á–∏, —á—Ç–æ–±—ã –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –≤–ª–∏—è–ª
             return Object.keys(customizations).sort().map(key => `${key}:${customizations[key]}`).join('|');
         }

         // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω–µ
         function getCustomizationString(customizations) {
             let parts = [];
             // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ customizationData –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω
             for (const key in customizations) {
                 if (customizationData[key]) {
                    const selectedOptionData = customizationData[key].find(opt => opt.id === customizations[key]);
                    if (selectedOptionData && !selectedOptionData.default) { // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ù–ï –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –æ–ø—Ü–∏–∏
                        parts.push(selectedOptionData.name);
                    } else if (!customizationData[key] && customizations[key]) {
                        // Fallback for keys not in customizationData (shouldn't happen with current setup)
                        parts.push(customizations[key]);
                    }
                 }
             }
            // –ï—Å–ª–∏ –Ω–µ—Ç –ù–ï –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –æ–ø—Ü–∏–π, –Ω–æ —Ç–æ–≤–∞—Ä –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã–π, –ø–æ–∫–∞–∂–µ–º —Ö–æ—Ç—è –±—ã –æ–±—ä–µ–º –∏–ª–∏ "–°—Ç–∞–Ω–¥–∞—Ä—Ç"
             if (parts.length === 0 && customizations.volume) {
                const volData = customizationData.volume.find(opt => opt.id === customizations.volume);
                 if(volData) parts.push(volData.name);
             }
             if (parts.length === 0) return "–°—Ç–∞–Ω–¥–∞—Ä—Ç"; // –ï—Å–ª–∏ —Å–æ–≤—Å–µ–º –Ω–∏—á–µ–≥–æ –Ω–µ—Ç

             return parts.join(', ');
         }


         // --- –û—Å–Ω–æ–≤–Ω—ã–µ –§—É–Ω–∫—Ü–∏–∏ ---

         // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–π –≤–∏–¥ (—Å –∞–Ω–∏–º–∞—Ü–∏–µ–π)
        function showView(viewIdToShow) {
            if (currentViewId === viewIdToShow) return; // –ù–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –Ω–∞ —Ç–æ—Ç –∂–µ –≤–∏–¥

            const currentViewElement = views[currentViewId];
            const nextViewElement = views[viewIdToShow];

            if (!nextViewElement) {
                console.error("View ID not found:", viewIdToShow);
                return;
            }

            previousViewId = currentViewId; // –ó–∞–ø–æ–º–Ω–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤–∏–¥

            if (currentViewElement) {
                currentViewElement.classList.add('exiting'); // –ù–∞—á–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é —É—Ö–æ–¥–∞
            }

            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–∏–¥ –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π *–¥–æ* —É–¥–∞–ª–µ–Ω–∏—è exiting —É —Å—Ç–∞—Ä–æ–≥–æ,
            // —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –º–µ—Ä—Ü–∞–Ω–∏—è —Ñ–æ–Ω–∞
             nextViewElement.classList.remove('exiting'); // –£–±—Ä–∞—Ç—å –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
             nextViewElement.classList.add('active');
             currentViewId = viewIdToShow;


            // –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ —É—Ö–æ–¥–∞ —Å—Ç–∞—Ä–æ–≥–æ –≤–∏–¥–∞, —É–±—Ä–∞—Ç—å –µ–≥–æ –∏–∑ DOM-–ø–æ—Ç–æ–∫–∞ (–∏–ª–∏ —Å–∫—Ä—ã—Ç—å)
             if (currentViewElement) {
                 // –ò—Å–ø–æ–ª—å–∑—É–µ–º setTimeout, —á—Ç–æ–±—ã –¥–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è transition
                 setTimeout(() => {
                     currentViewElement.classList.remove('active');
                     currentViewElement.classList.remove('exiting');
                 }, parseFloat(getComputedStyle(currentViewElement).transitionDuration) * 1000);
             }


            window.scrollTo(0, 0); // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–≤–µ—Ä—Ö

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –ø–µ—Ä–µ—à–ª–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
            if (currentViewId === 'order-view') {
                updateOrderViewButtons();
            } else {
                 // –°–±—Ä–æ—Å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π, –µ—Å–ª–∏ –º—ã –ù–ï –≤ –∫–æ—Ä–∑–∏–Ω–µ
                 newOrderBtn.style.display = 'none';
            }
        }


        // –†–µ–Ω–¥–µ—Ä –º–µ–Ω—é (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–æ–∏—Å–∫–æ–º)
        function renderMenu() {
            menuGrid.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞

            // 1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            let filteredItems = menuData;
            if (currentFilterCategory !== 'all') {
                filteredItems = menuData.filter(item => item.category === currentFilterCategory);
            }

            // 2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É
            const searchTerm = currentSearchTerm.toLowerCase().trim();
            if (searchTerm) {
                filteredItems = filteredItems.filter(item => item.name.toLowerCase().includes(searchTerm));
            }

            // 3. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥
            if (filteredItems.length === 0) {
                menuGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: #777;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>';
                return;
            }

            filteredItems.forEach(item => {
                const div = document.createElement('div');
                div.classList.add('menu-item');
                div.dataset.itemId = item.id;
                // TODO: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É inStock –∏ –∫–ª–∞—Å—Å disabled
                // div.classList.toggle('disabled', !item.inStock);

                div.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" loading="lazy">
                    <div>
                         <h3>${item.name}</h3>
                         <span class="price">${item.basePrice}‚Ç∏</span>
                    </div>
                `;

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                 // if (item.inStock) { // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤ –Ω–∞–ª–∏—á–∏–∏
                     div.addEventListener('click', () => {
                        if(item.customizable) {
                             handleMenuItemClick(item.id);
                        } else {
                             // –î–ª—è –Ω–µ–∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–¥–µ—Å–µ—Ä—Ç—ã) - —Å—Ä–∞–∑—É –≤ –∫–æ—Ä–∑–∏–Ω—É
                             addNonCustomizableItem(item.id);
                        }
                    });
                 // }

                menuGrid.appendChild(div);
            });
        }

         // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
         function addNonCustomizableItem(itemId) {
             const itemData = menuData.find(i => i.id === itemId);
             if (!itemData) return;

             const customizationKey = 'non-customizable'; // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è —Ç–∞–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
             const existingItem = currentOrder.find(orderItem => orderItem.id === itemId && orderItem.customizationKey === customizationKey);

             if (existingItem) {
                 existingItem.quantity++;
             } else {
                 const orderItem = {
                     orderItemId: `item-${Date.now()}-${Math.random().toString(16).slice(2)}`, // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
                     id: itemData.id,
                     name: itemData.name,
                     price: itemData.basePrice,
                     quantity: 1,
                     customizations: {}, // –ü—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç
                     customizationKey: customizationKey,
                     customizationString: '' // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
                 };
                 currentOrder.push(orderItem);
                 // –ê–Ω–∏–º–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω–µ (–µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞)
                 setTimeout(() => { // –î–∞—Ç—å –≤—Ä–µ–º—è –Ω–∞ —Ä–µ—Ä–µ–Ω–¥–µ—Ä, –µ—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞
                     const liElement = orderItemsList.querySelector(`li[data-order-item-id="${orderItem.orderItemId}"]`);
                     if(liElement) {
                        liElement.classList.add('item-entering');
                        setTimeout(() => liElement.classList.remove('item-entering'), 10); // –ù–∞—á–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é
                     }
                 }, 0);
             }
             updateOrderSummary();
             saveOrderToLocalStorage();
             showTemporaryMessage(`${itemData.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`, "success");
         }


        // –ö–ª–∏–∫ –ø–æ –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º–æ–º—É —Ç–æ–≤–∞—Ä—É –≤ –º–µ–Ω—é
        function handleMenuItemClick(itemId) {
            const item = menuData.find(i => i.id === itemId);
            if (!item || !item.customizable) return;

            selectedItem = { ...item }; // –ö–æ–ø–∏—Ä—É–µ–º
            editingOrderItemId = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            addUpdateOrderBtn.textContent = "–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑"; // –°–±—Ä–æ—Å —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏ –æ–ø—Ü–∏–π –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏—Ö HTML
            Object.keys(customizationOptionSections).forEach(optionType => {
                const section = customizationOptionSections[optionType];
                const container = customizationOptionsContainers[optionType];
                const isAvailable = selectedItem.options.includes(optionType);

                section.classList.toggle('visible', isAvailable);

                if (isAvailable && container && customizationData[optionType]) {
                     generateOptionsHTML(optionType, customizationData[optionType]); // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
                } else if (container) {
                    container.innerHTML = ''; // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –µ—Å–ª–∏ –æ–ø—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
                }
            });

            customizationItemName.textContent = `–ù–∞—Å—Ç—Ä–æ–π—Ç–µ: ${selectedItem.name}`;
            updateCustomizationPrice(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ü–µ–Ω—É —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏
            showView('customization-view');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –≤ –æ–∫–Ω–µ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏
        function updateCustomizationPrice() {
            if (!selectedItem) return;

            let currentPrice = selectedItem.basePrice;
            let volumeMultiplier = 1.0;

            // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Ç–∏–ø–∞–º –æ–ø—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ DOM
            Object.keys(customizationOptionsContainers).forEach(optionType => {
                const container = customizationOptionsContainers[optionType];
                const selectedRadio = container.querySelector(`input[name="${optionType}"]:checked`);

                if (selectedRadio) {
                    const priceMod = parseInt(selectedRadio.dataset.priceMod) || 0;
                    const multiplier = parseFloat(selectedRadio.dataset.multiplier) || null;

                    currentPrice += priceMod;
                    if (multiplier !== null) {
                        volumeMultiplier = multiplier;
                    }
                }
            });

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å –æ–±—ä–µ–º–∞ –ü–û–°–õ–ï –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Ü–µ–Ω—ã
            currentPrice = Math.round(selectedItem.basePrice * volumeMultiplier) + (currentPrice - selectedItem.basePrice);

            currentItemPriceDisplay.textContent = `–¶–µ–Ω–∞: ${currentPrice}‚Ç∏`;
            return currentPrice; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö
        }

        // –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑" / "–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é"
        function handleAddUpdateItem() {
            if (!selectedItem && !editingOrderItemId) return; // –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω —Ç–æ–≤–∞—Ä –∏–ª–∏ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏
            const currentCustomizations = {};
            const itemOptions = selectedItem ? selectedItem.options : // –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π
                                 currentOrder.find(i => i.orderItemId === editingOrderItemId)?.options || []; // –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º (–Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å options –≤ orderItem?)
                                                                                                       // –ü—Ä–æ—â–µ –≤–∑—è—Ç—å –∏–∑ menuData –ø–æ id —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –∏—Ç–µ–º–∞
            const originalItemData = menuData.find(m => m.id === (selectedItem?.id || currentOrder.find(i => i.orderItemId === editingOrderItemId)?.id));
            const availableOptions = originalItemData?.options || Object.keys(customizationOptionsContainers); // –í—Å–µ –æ–ø—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ

            availableOptions.forEach(optionType => {
                const container = customizationOptionsContainers[optionType];
                const selectedRadio = container.querySelector(`input[name="${optionType}"]:checked`);
                if (selectedRadio) {
                    currentCustomizations[optionType] = selectedRadio.value;
                }
                // –ï—Å–ª–∏ –æ–ø—Ü–∏–∏ –Ω–µ—Ç –≤ DOM (—Å–∫—Ä—ã—Ç–∞), –Ω–æ –æ–Ω–∞ –µ—Å—Ç—å –≤ customizationData, –¥–æ–±–∞–≤–∏–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                else if(customizationData[optionType] && !customizationOptionSections[optionType].classList.contains('visible')) {
                    const defaultOption = customizationData[optionType].find(opt => opt.default);
                    if(defaultOption) {
                        currentCustomizations[optionType] = defaultOption.id;
                    }
                }
            });

             const finalPrice = updateCustomizationPrice(); // –ü–æ–ª—É—á–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Ü–µ–Ω—É
             const customizationKey = getCustomizationKey(currentCustomizations);
             const customizationString = getCustomizationString(currentCustomizations);

             if (editingOrderItemId) {
                // --- –†–µ–∂–∏–º –û–±–Ω–æ–≤–ª–µ–Ω–∏—è ---
                const itemToUpdate = currentOrder.find(item => item.orderItemId === editingOrderItemId);
                if (itemToUpdate) {
                    itemToUpdate.price = finalPrice; // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—É –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
                    itemToUpdate.customizations = currentCustomizations;
                    itemToUpdate.customizationKey = customizationKey;
                    itemToUpdate.customizationString = customizationString;
                    // Quantity –Ω–µ –º–µ–Ω—è–µ–º –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, —Ç–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                }
                 editingOrderItemId = null; // –í—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                 addUpdateOrderBtn.textContent = "–î–æ–±–∞–≤–∏—Ç—å –≤ –∑–∞–∫–∞–∑"; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                 saveOrderToLocalStorage();
                 updateOrderSummary();
                 showView('order-view'); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –∫–æ—Ä–∑–∏–Ω—É
                 showTemporaryMessage("–ü–æ–∑–∏—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞", "success");

             } else if (selectedItem) {
                 // --- –†–µ–∂–∏–º –î–æ–±–∞–≤–ª–µ–Ω–∏—è ---
                 const existingItem = currentOrder.find(orderItem =>
                    orderItem.id === selectedItem.id && orderItem.customizationKey === customizationKey
                 );

                 if (existingItem) {
                     // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
                     existingItem.quantity++;
                 } else {
                     // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
                     const orderItem = {
                         orderItemId: `item-${Date.now()}-${Math.random().toString(16).slice(2)}`,
                         id: selectedItem.id,
                         name: selectedItem.name,
                         price: finalPrice, // –¶–µ–Ω–∞ –∑–∞ 1 —à—Ç
                         quantity: 1,
                         customizations: currentCustomizations,
                         customizationKey: customizationKey,
                         customizationString: customizationString
                     };
                     currentOrder.push(orderItem);
                     // –ê–Ω–∏–º–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞)
                     setTimeout(() => {
                        const liElement = orderItemsList.querySelector(`li[data-order-item-id="${orderItem.orderItemId}"]`);
                         if(liElement) {
                             liElement.classList.add('item-entering');
                             setTimeout(() => liElement.classList.remove('item-entering'), 10);
                         }
                     }, 0);

                 }
                 saveOrderToLocalStorage();
                 updateOrderSummary();
                 showView('menu-view'); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –º–µ–Ω—é
                 showTemporaryMessage(`${selectedItem.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É`, "success");
                 selectedItem = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏—Ç–µ–º
             }
        }


        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã
        function updateOrderSummary() {
            orderItemsList.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞
            let total = 0;

            if (currentOrder.length === 0) {
                 orderContent.style.display = 'none';
                 emptyOrderMessage.style.display = 'block';
            } else {
                 orderContent.style.display = 'block';
                 emptyOrderMessage.style.display = 'none';

                 currentOrder.forEach(item => {
                     const li = document.createElement('li');
                     li.dataset.orderItemId = item.orderItemId; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ID

                     li.innerHTML = `
                        <div class="item-details">
                            <span class="item-name">${item.name}</span>
                            ${item.customizationString ? `<span class="item-customizations">${item.customizationString}</span>` : ''}
                        </div>
                        <div class="item-controls">
                             <div class="quantity-controls">
                                 <button class="btn-quantity btn-decrease" data-id="${item.orderItemId}" title="–£–º–µ–Ω—å—à–∏—Ç—å">-</button>
                                 <span class="item-quantity">${item.quantity}</span>
                                 <button class="btn-quantity btn-increase" data-id="${item.orderItemId}" title="–£–≤–µ–ª–∏—á–∏—Ç—å">+</button>
                             </div>
                             <span class="item-price">${item.price * item.quantity}‚Ç∏</span>
                             ${menuData.find(m => m.id === item.id)?.customizable ? // –ö–Ω–æ–ø–∫–∞ Edit —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º—ã—Ö
                                `<button class="btn-edit-item" data-id="${item.orderItemId}" title="–ò–∑–º–µ–Ω–∏—Ç—å">‚úèÔ∏è</button>` :
                                '<span style="width: 24px; display: inline-block;"></span>' // –ü—É—Å—Ç—ã—à–∫–∞ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
                             }
                             <button class="btn-remove-item" data-id="${item.orderItemId}" title="–£–¥–∞–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é">√ó</button>
                        </div>
                    `;
                     orderItemsList.appendChild(li);
                     total += item.price * item.quantity;
                 });

                 // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
                 attachCartItemListeners();
             }

            orderTotalDisplay.textContent = `–û–±—â–∞—è —Å—É–º–º–∞: ${total}‚Ç∏`;
            cartCountSpan.textContent = currentOrder.reduce((sum, item) => sum + item.quantity, 0); // –°—É–º–º–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏, –µ—Å–ª–∏ –º—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ
            if (currentViewId === 'order-view') {
                updateOrderViewButtons();
            }
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ—Ä–∑–∏–Ω—ã
        function attachCartItemListeners() {
            orderItemsList.querySelectorAll('.btn-decrease').forEach(btn => {
                btn.addEventListener('click', () => decreaseQuantity(btn.dataset.id));
            });
            orderItemsList.querySelectorAll('.btn-increase').forEach(btn => {
                btn.addEventListener('click', () => increaseQuantity(btn.dataset.id));
            });
            orderItemsList.querySelectorAll('.btn-edit-item').forEach(btn => {
                btn.addEventListener('click', () => handleEditItem(btn.dataset.id));
            });
            orderItemsList.querySelectorAll('.btn-remove-item').forEach(btn => {
                btn.addEventListener('click', () => removeItemFromOrder(btn.dataset.id));
            });
        }


        // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        function increaseQuantity(orderItemId) {
            const item = currentOrder.find(i => i.orderItemId === orderItemId);
            if (item) {
                item.quantity++;
                saveOrderToLocalStorage();
                updateOrderSummary(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –∫–æ—Ä–∑–∏–Ω—É
            }
        }

        // –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        function decreaseQuantity(orderItemId) {
            const item = currentOrder.find(i => i.orderItemId === orderItemId);
            if (item) {
                item.quantity--;
                if (item.quantity <= 0) {
                    removeItemFromOrder(orderItemId); // –£–¥–∞–ª–∏—Ç—å, –µ—Å–ª–∏ 0
                } else {
                    saveOrderToLocalStorage();
                    updateOrderSummary(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –∫–æ—Ä–∑–∏–Ω—É
                }
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ –∑–∞–∫–∞–∑–∞
        function removeItemFromOrder(orderItemIdToRemove) {
            const itemIndex = currentOrder.findIndex(item => item.orderItemId === orderItemIdToRemove);
            if (itemIndex > -1) {
                const liElement = orderItemsList.querySelector(`li[data-order-item-id="${orderItemIdToRemove}"]`);
                if(liElement) { // –ê–Ω–∏–º–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è
                    liElement.classList.add('item-leaving');
                    // –£–¥–∞–ª—è–µ–º –∏–∑ –º–∞—Å—Å–∏–≤–∞ –∏ localStorage –ü–û–°–õ–ï –∞–Ω–∏–º–∞—Ü–∏–∏
                     setTimeout(() => {
                         currentOrder.splice(itemIndex, 1);
                         saveOrderToLocalStorage();
                         updateOrderSummary(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –±–µ–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                         showTemporaryMessage("–ü–æ–∑–∏—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞", "info");
                    }, 400); // –î–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å transition-duration
                } else {
                    // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–µ—Ç –≤ DOM (—Ä–µ–¥–∫–æ), —É–¥–∞–ª—è–µ–º —Å—Ä–∞–∑—É
                     currentOrder.splice(itemIndex, 1);
                     saveOrderToLocalStorage();
                     updateOrderSummary();
                     showTemporaryMessage("–ü–æ–∑–∏—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞", "info");
                }


            }
        }


        // –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ "–ò–∑–º–µ–Ω–∏—Ç—å" –≤ –∫–æ—Ä–∑–∏–Ω–µ
        function handleEditItem(orderItemId) {
            const itemToEdit = currentOrder.find(item => item.orderItemId === orderItemId);
            if (!itemToEdit) return;

            const originalMenuItem = menuData.find(m => m.id === itemToEdit.id);
            if (!originalMenuItem || !originalMenuItem.customizable) return; // –ù–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä—É–µ–º–æ–µ

            editingOrderItemId = orderItemId;
            selectedItem = { ...originalMenuItem }; // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –±–∞–∑–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
            addUpdateOrderBtn.textContent = "–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é"; // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏–∏ –æ–ø—Ü–∏–π
            Object.keys(customizationOptionSections).forEach(optionType => {
                const section = customizationOptionSections[optionType];
                const container = customizationOptionsContainers[optionType];
                const isAvailable = selectedItem.options.includes(optionType);

                section.classList.toggle('visible', isAvailable);

                if (isAvailable && container && customizationData[optionType]) {
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º HTML –∏ –í–´–ë–ò–†–ê–ï–ú –Ω—É–∂–Ω—É—é –æ–ø—Ü–∏—é –∏–∑ itemToEdit.customizations
                     generateOptionsHTML(optionType, customizationData[optionType], itemToEdit.customizations[optionType]);
                } else if (container) {
                    container.innerHTML = '';
                }
            });


            customizationItemName.textContent = `–ò–∑–º–µ–Ω–∏—Ç—å: ${itemToEdit.name}`;
            updateCustomizationPrice(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            showView('customization-view'); // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏
        }


        // –û—á–∏—Å—Ç–∫–∞ –∑–∞–∫–∞–∑–∞
        function handleClearOrder() {
            if (currentOrder.length > 0) {
                 if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∑–∞–∫–∞–∑?")) {
                     currentOrder = [];
                     saveOrderToLocalStorage(); // –û—á–∏—â–∞–µ–º –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
                     updateOrderSummary(); // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ (—Å–ø–∏—Å–æ–∫, —Å—É–º–º—É, —Å—á–µ—Ç—á–∏–∫)
                     qrAndStatusSection.style.display = 'none';
                     orderStatusDisplay.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ...';
                     orderStatusDisplay.className = '';
                     statusLoader.style.display = 'none';
                     showTemporaryMessage("–ó–∞–∫–∞–∑ –æ—á–∏—â–µ–Ω", "info");
                     updateOrderViewButtons(); // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏
                 }
            } else {
                 showTemporaryMessage("–ó–∞–∫–∞–∑ —É–∂–µ –ø—É—Å—Ç", "info");
            }
        }

        // –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (–ª–æ–≥–∏–∫–∞ QR –∏ —Å—Ç–∞—Ç—É—Å–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–µ–π)
        function handleCheckout() {
            if (currentOrder.length === 0) {
                showTemporaryMessage("–í–∞—à –∑–∞–∫–∞–∑ –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!", "error");
                return;
            }

             // 1. –î–∞–Ω–Ω—ã–µ –¥–ª—è QR (—Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞—é—Ç quantity –∏ —Å—Ç—Ä–æ–∫—É –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏)
             const qrData = JSON.stringify({
                 orderId: `WEB-${Date.now()}`,
                 items: currentOrder.map(item => ({
                     name: item.name,
                     quantity: item.quantity,
                     customizations: item.customizationString || '–°—Ç–∞–Ω–¥–∞—Ä—Ç',
                     pricePerItem: item.price,
                     totalItemPrice: item.price * item.quantity
                 })),
                 total: currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0)
             });

             // 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR –∫–æ–¥–∞ (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
             qrCodeContainer.innerHTML = '';
             try {
                 new QRCode(qrCodeContainer, { text: qrData, width: 160, height: 160, colorDark : "#000000", colorLight : "#ffffff", correctLevel : QRCode.CorrectLevel.H });
             } catch (e) {
                 console.error("–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR:", e);
                 qrCodeContainer.innerHTML = '<p style="color: red; font-size: 0.8em;">–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR.</p>';
             }

            // 3. –ü–æ–∫–∞–∑ QR –∏ —Å—Ç–∞—Ç—É—Å–∞
            qrAndStatusSection.style.display = 'block';

            // 4. –°–∏–º—É–ª—è—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
            simulateOrderStatus();

            // 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
             updateOrderViewButtons(true); // –ü–µ—Ä–µ–¥–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ –∑–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω

            // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
             orderItemsList.style.pointerEvents = 'none';
             orderItemsList.querySelectorAll('.btn-decrease, .btn-increase, .btn-edit-item, .btn-remove-item').forEach(btn => btn.disabled = true); // –î–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏

            showTemporaryMessage("–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –°–ª–µ–¥–∏—Ç–µ –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º.", "success");
        }

        // –°–∏–º—É–ª—è—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞ (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
        function simulateOrderStatus() { /* ... –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... */
             orderStatusDisplay.textContent = '–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç';
             orderStatusDisplay.className = 'status-pending';
             statusLoader.style.display = 'block';
             setTimeout(() => {
                  if (currentViewId !== 'order-view') return;
                 orderStatusDisplay.textContent = '–ì–æ—Ç–æ–≤–∏—Ç—Å—è...';
                 orderStatusDisplay.className = 'status-processing';
             }, 4000);
             setTimeout(() => {
                 if (currentViewId !== 'order-view') return;
                 orderStatusDisplay.textContent = '–ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ!';
                 orderStatusDisplay.className = 'status-ready';
                  statusLoader.style.display = 'none';
             }, 10000);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞
        function handleNewOrder() {
            currentOrder = [];
            selectedItem = null;
            editingOrderItemId = null;
            saveOrderToLocalStorage(); // –û—á–∏—â–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
            updateOrderSummary(); // –û—á–∏—Å—Ç–∏—Ç —Å–ø–∏—Å–æ–∫, —Å—É–º–º—É, —Å—á–µ—Ç—á–∏–∫
            qrCodeContainer.innerHTML = '';
            qrAndStatusSection.style.display = 'none';
             orderStatusDisplay.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ...';
             orderStatusDisplay.className = '';
             statusLoader.style.display = 'none';
             orderItemsList.style.pointerEvents = 'auto'; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫
             // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã (—Ö–æ—Ç—è –æ–Ω–∏ —É–¥–∞–ª—è—Ç—Å—è –ø—Ä–∏ updateOrderSummary)
             // orderItemsList.querySelectorAll('.btn-decrease, .btn-increase, .btn-edit-item, .btn-remove-item').forEach(btn => btn.disabled = false);

            showView('menu-view'); // –ü–µ—Ä–µ—Ö–æ–¥ –≤ –º–µ–Ω—é
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –≤ –í–ò–î–ï –ó–ê–ö–ê–ó–ê
        function updateOrderViewButtons(isOrderPlaced = false) {
            // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –¢–û–õ–¨–ö–û –∫–æ–≥–¥–∞ –∞–∫—Ç–∏–≤–µ–Ω –≤–∏–¥ 'order-view'
             // –∏–ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ checkout
             if (currentViewId !== 'order-view' && !isOrderPlaced) {
                 // –ï—Å–ª–∏ –º—ã –Ω–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ –∏ –Ω–µ —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ñ–æ—Ä–º–∏–ª–∏ –∑–∞–∫–∞–∑, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
                 clearOrderBtn.style.display = 'none';
                 checkoutBtn.style.display = 'none';
                 newOrderBtn.style.display = 'none';
                 return;
             }

            const isOrderEmpty = currentOrder.length === 0;
            const orderHasBeenPlaced = isOrderPlaced || qrAndStatusSection.style.display === 'block'; // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ QR/—Å—Ç–∞—Ç—É—Å—É

            clearOrderBtn.style.display = !isOrderEmpty && !orderHasBeenPlaced ? 'inline-block' : 'none';
            checkoutBtn.style.display = !isOrderEmpty && !orderHasBeenPlaced ? 'inline-block' : 'none';
            newOrderBtn.style.display = orderHasBeenPlaced ? 'inline-block' : 'none';

            // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –ø—É—Å—Ç–æ–º –∑–∞–∫–∞–∑–µ –∏ —Å–∞–º–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
             emptyOrderMessage.style.display = isOrderEmpty && !orderHasBeenPlaced ? 'block' : 'none';
             orderContent.style.display = (isOrderEmpty && !orderHasBeenPlaced) ? 'none' : 'block'; // –°–∫—Ä—ã–≤–∞–µ–º –µ—Å–ª–∏ –ø—É—Å—Ç–æ –∏ –Ω–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω

             // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ QR/—Å—Ç–∞—Ç—É—Å–æ–º
             if (!orderHasBeenPlaced) {
                 qrAndStatusSection.style.display = 'none';
                  orderItemsList.style.pointerEvents = 'auto'; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫
                  // –ö–Ω–æ–ø–∫–∏ –∏ —Ç–∞–∫ –±—É–¥—É—Ç –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞–Ω—ã –≤ updateOrderSummary
             } else {
                 qrAndStatusSection.style.display = 'block'; // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –ø–æ–∫–∞–∑–∞–Ω, –µ—Å–ª–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω
                  orderItemsList.style.pointerEvents = 'none'; // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫
             }
         }


        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
        document.addEventListener('DOMContentLoaded', () => {
            loadOrderFromLocalStorage(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑ –ü–ï–†–ï–î –ø–µ—Ä–≤—ã–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º

            renderMenu(); // –†–µ–Ω–¥–µ—Ä–∏–º –º–µ–Ω—é
            updateOrderSummary(); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ—Ä–∑–∏–Ω—É (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∞ —Å–∫—Ä—ã—Ç–∞) –∏ —Å—á–µ—Ç—á–∏–∫ –≤ —à–∞–ø–∫–µ
            showView(currentViewId); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∏–¥ (–æ–±—ã—á–Ω–æ –º–µ–Ω—é)

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø–æ–∏—Å–∫–∞
            categoryFiltersContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('btn-filter')) {
                    categoryFiltersContainer.querySelector('.active')?.classList.remove('active');
                    e.target.classList.add('active');
                    currentFilterCategory = e.target.dataset.category;
                    renderMenu(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –º–µ–Ω—é —Å –Ω–æ–≤—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º
                }
            });
            menuSearchInput.addEventListener('input', (e) => {
                currentSearchTerm = e.target.value;
                renderMenu(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å –º–µ–Ω—é –ø—Ä–∏ –≤–≤–æ–¥–µ
            });


            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–ø—Ü–∏–π –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏
            Object.values(customizationOptionsContainers).forEach(container => {
                if(container) { // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null, –µ—Å–ª–∏ –æ–ø—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
                     container.addEventListener('change', updateCustomizationPrice);
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            backToMenuBtn.addEventListener('click', () => showView('menu-view'));
            addUpdateOrderBtn.addEventListener('click', handleAddUpdateItem); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é –æ–±—â—É—é —Ñ—É–Ω–∫—Ü–∏—é
            clearOrderBtn.addEventListener('click', handleClearOrder);
            checkoutBtn.addEventListener('click', handleCheckout);
            newOrderBtn.addEventListener('click', handleNewOrder);
            goToCartBtn.addEventListener('click', () => {
                // updateOrderSummary(); // –û–±–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∏ –≤—ã–∑–æ–≤–µ updateOrderViewButtons –≤–Ω—É—Ç—Ä–∏ showView
                showView('order-view');
            });

            // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∫–æ—Ä–∑–∏–Ω—ã (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –Ω–∞—á–Ω–µ–º —Å –Ω–µ–µ)
            updateOrderViewButtons();
        });

    </script>

</body>
</html>
